name: Teste Tecnico
on:
  pull_request:
    branches:
      - main
      - develop
      - 'releases/**'
env:
  USERNAME: ${{ vars.LOGIN_USER }}
  PASSWORD: ${{ secrets.LOGIN_PASSWORD }}
  LANGUAGE: ${{ vars.LANGUAGE }} 
  CYPRESS_USERNAME: ${{ vars.LOGIN_USER }} 
  CYPRESS_PASSWORD: ${{ secrets.LOGIN_PASSWORD }} 

jobs:
  cypress-run:
    runs-on: ubuntu-22.04
    steps:
      - run: echo "vars.LOGIN_USER is $USERNAME"
      - run: echo "secrets.LOGIN_PASSWORD is $PASSWORD"
      - run: echo "vars.LANGUAGE is $LANGUAGE"
      - run: echo "CYPRESS_USERNAME->vars.LOGIN_USER is $CYPRESS_USERNAME"
      - run: echo "CYPRESS_PASSWORD->secrets.LOGIN_PASSWORD is $CYPRESS_PASSWORD"
      - name: Checkout
        uses: actions/checkout@v4
      # Install npm dependencies, cache them correctly
      # and run all Cypress tests
      - name: Install dependencies
        run: npm install
      - name: Cypress run
        uses: cypress-io/github-action@v6
        env:
          CYPRESS_USERNAME: ${{ vars.LOGIN_USER }} 
          CYPRESS_PASSWORD: ${{ secrets.LOGIN_PASSWORD }}
          USERNAME: ${{ vars.LOGIN_USER }}
          PASSWORD: ${{ secrets.LOGIN_PASSWORD }}
          LANGUAGE: ${{ vars.LANGUAGE }}  
      - uses: actions/upload-artifact@v4
        # add the line below to store screenshots only on failures
        if: failure()
        with:
          name: cypress-screenshots
          path: cypress/screenshots
          if-no-files-found: ignore # 'warn' or 'error' are also available, defaults to `warn`
      - uses: actions/upload-artifact@v4
        with:
          name: cypress-videos
          path: cypress/videos
          if-no-files-found: ignore # 'warn' or 'error' are also available, defaults to `warn`
